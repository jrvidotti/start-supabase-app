# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

### Core Development

- `yarn dev` - Start development server on port 3000
- `yarn build` - Build for production (includes TypeScript checking)
- `yarn start` - Start production server

### Database Management (Drizzle ORM)

- `yarn db:generate` - Generate SQL migrations from schema changes
- `yarn db:push` - Push schema changes directly to database (for development)
- `yarn db:migrate` - Run pending migrations
- `yarn db:studio` - Open Drizzle Studio for database management
- `yarn supabase:gen` - Generate Supabase types from schema

### Required Dependencies

This project uses `@vitejs/plugin-react` which may need to be installed if missing:

- `yarn add -D @vitejs/plugin-react`

## Project Architecture

### Framework Stack

- **TanStack Start**: Full-stack React framework with file-based routing
- **TanStack Router**: Type-safe client-side routing
- **Supabase**: Authentication and PostgreSQL database backend
- **Drizzle ORM**: Database migrations and schema definition
- **Tailwind CSS**: Styling framework
- **TypeScript**: Type safety with strict configuration

### Directory Structure

```
src/
├── components/          # Reusable UI components
│   ├── Auth.tsx        # Generic auth form component
│   ├── Login.tsx       # Login-specific component
│   └── DefaultCatchBoundary.tsx
├── routes/             # File-based routing (TanStack Router)
│   ├── __root.tsx      # Root layout with navigation and user context
│   ├── _authed.tsx     # Authentication guard route
│   ├── _authed/        # Protected routes requiring authentication
│   └── [other routes]
├── utils/
│   ├── supabase.ts     # Supabase server client configuration
│   ├── posts.ts        # Post-related server functions (now using Drizzle)
│   └── seo.ts          # SEO utilities
└── hooks/              # Custom React hooks
drizzle/
├── migrations/         # Generated SQL migration files
└── schema.ts           # Database schema definitions
```

### Authentication Architecture

- **Root Layout** (`__root.tsx`): Fetches user session on every request via `fetchUser` server function
- **Authentication Guard** (`_authed.tsx`): Protects routes by checking user context, redirects to login if unauthenticated
- **Supabase Integration**: Server-side authentication using `@supabase/ssr` with cookie-based session management

### Database Architecture (Drizzle ORM)

Drizzle is used for migrations and schema definition. The database is managed by Supabase, including type safety.

- **Schema Definition** (`drizzle/schema.ts`): Table schemas generated by Drizzle
- **Migrations**: Generated SQL files in `drizzle/migrations/` for version control

### Server Functions Pattern

The codebase uses TanStack Start's `createServerFn` pattern for server-side operations:

- Authentication functions (login, user fetching)
- Database operations using Drizzle ORM (CRUD operations for posts)
- All server functions include proper validation and error handling

### Environment Requirements

Required environment variables:

- `VITE_SUPABASE_URL` - Supabase project URL
- `VITE_SUPABASE_ANON_KEY` - Supabase anon public key
- `DATABASE_URL` - PostgreSQL connection string (for Drizzle)
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase service role key (for admin operations)

Optional environment variables:

- `SUPABASE_PROJECT_ID` - Supabase project ID (for generating Supabase types)
- `VITE_AZURE_OAUTH_ENABLED` - Enable Azure OAuth authentication (must be set to true if using Azure OAuth)
- `VITE_GOOGLE_OAUTH_ENABLED` - Enable Google OAuth authentication (must be set to true if using Google OAuth)

### TypeScript Configuration

- Strict mode enabled with comprehensive compiler options
- Path aliases configured: `~/*` maps to `./src/*`
- ESNext module system with bundler resolution
- React JSX transform configured

### Styling Approach

- Tailwind CSS with default configuration
- Dark mode classes supported throughout components
- Responsive design patterns used in layouts
